{% extends "shop/base.html" %}
{% block head %}
{% let page = "crm" %}
<style>
	.crm-header {
		display: flex;
		justify-content: space-between;
		align-items: center;
		gap: 12px;
		flex-wrap: wrap;
	}
	.crm-header h2 {
		margin: 0;
	}
	.crm-header a {
		color: var(--accent);
		text-decoration: none;
	}
	.crm-table {
		width: 100%;
		border-collapse: collapse;
		margin-top: 16px;
		background: var(--panel);
		border-radius: 12px;
		overflow: hidden;
		border: 1px solid var(--border);
	}
	.crm-table th, .crm-table td {
		padding: 12px 14px;
		border-bottom: 1px solid var(--border);
		text-align: left;
		vertical-align: top;
	}
	.crm-table th {
		background: var(--panel-2);
		font-weight: 700;
	}
	.crm-table td small {
		color: var(--muted);
	}
	.crm-meta {
		color: var(--muted);
		font-size: 12px;
	}
	.crm-actions form {
		margin: 0;
	}
	.crm-actions button {
		border: 0;
		background: var(--button-bg);
		color: var(--button-text);
		padding: 8px 12px;
		border-radius: 10px;
		cursor: pointer;
		border: 1px solid var(--button-border);
	}
	.crm-empty {
		margin-top: 18px;
		color: var(--muted);
	}
	.crm-items {
		margin: 6px 0 0;
		padding-left: 18px;
	}
</style>
{% endblock %}
{% block content %}
<div class="crm-header">
	<h2>Замовлення</h2>
	<a href="/shop/{{shop.id}}/crm">← Назад до CRM</a>
</div>
{% if items.len() == 0 %}
	<p class="crm-empty">Замовлень поки немає.</p>
{% else %}
<table class="crm-table">
	<thead>
		<tr>
			<th>Клієнт</th>
			<th>Доставка / Оплата</th>
			<th>Товари</th>
			<th>Сума</th>
			<th>Дата</th>
			<th></th>
		</tr>
	</thead>
	<tbody>
	{% for item in items %}
		<tr>
			<td>
				<div><strong>{{ item.customer_name }}</strong></div>
				<div class="crm-meta">{{ item.phone }}</div>
				{% if item.email.is_some() %}
					<div class="crm-meta">{{ item.email.as_ref().unwrap() }}</div>
				{% endif %}
			</td>
			<td>
				<div>{{ item.delivery }}</div>
				{% if item.city_name.is_some() %}
					<div class="crm-meta">{{ item.city_name.as_ref().unwrap() }}</div>
				{% endif %}
				{% if item.branch_name.is_some() %}
					<div class="crm-meta">{{ item.branch_name.as_ref().unwrap() }}</div>
				{% endif %}
				<div class="crm-meta">{{ item.payment }}</div>
			</td>
			<td>
				<div><strong>{{ item.items_count }}</strong> позицій</div>
				<ul class="crm-items">
				{% for product in item.items %}
					<li>
						{{ product.title }}
						<small>
							({{ product.article }})
							{% if product.price.is_some() %}
								{{ product.price.as_ref().unwrap() }} грн
							{% else %}
								Ціну уточнюйте
							{% endif %}
							× {{ product.quantity }}
						</small>
					</li>
				{% endfor %}
				</ul>
				{% if item.comment.is_some() %}
					<div class="crm-meta">Коментар: {{ item.comment.as_ref().unwrap() }}</div>
				{% endif %}
			</td>
			<td><strong>{{ item.total }} грн</strong></td>
			<td>{{ item.created_at }}</td>
			<td class="crm-actions">
				<form method="post" action="/shop/{{shop.id}}/crm/orders/{{ item.id }}/delete">
					<button type="submit">Видалити</button>
				</form>
			</td>
		</tr>
	{% endfor %}
	</tbody>
</table>
{% endif %}
{% endblock %}
